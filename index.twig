<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="{{ meta.robots }}">
  <title>{% if meta.title %}{{ meta.title }} | {% endif %}{{ site_title }}</title>
  <link rel="stylesheet" href="{{ theme_url }}/style.css" type="text/css" />
</head>
<body>

<aside class="main-nav">
<nav class="menu">
<ul>
    {% for page in pages if page.title %}
        {% set pageDepth = page.id|split('/')|length %}
        {% if (pageDepth == 2) and (page.id ends with "/index") or (pageDepth == 1) %}
            <li>
                <a href="{{ page.url }}">{{ page.title }}</a>
            </li>
        {% endif %}
    {% endfor %}
</ul>
</nav>
<nav class="tocbot"></nav>
</aside>

<main class="main-content">
  <article class="article">
    {{ content }}
  </article>
</main>


<script src="{{ theme_url }}/tocbot.min.js"></script>
<link href="{{ theme_url }}/tocbot.min.css" rel="stylesheet">
<script>
if ($('.tocbot').length > 0) {
    var headerEl = 'h1,h2',  //headers 
        content = '.article',//文章容器
        idArr = {};  //标题数组以确定是否增加索引id
    //add #id
    $(content).children(headerEl).each(function () {
        //去除空格以及多余标点
        var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');
 
        headerId = headerId.toLowerCase();
        if (idArr[headerId]) {
            //id已经存在
            $(this).attr('id', headerId + '-' + idArr[headerId]);
            idArr[headerId]++;
        }
        else {
            //id未存在
            idArr[headerId] = 1;
            $(this).attr('id', headerId);
        }
    });
tocbot.init({
  // 构建目录的容器
  tocSelector: '.tocbot',
  contentSelector: content,
  headingSelector: headerEl,
  //以下6条代码为跟随滚动功能
  positionFixedSelector: '.tocbot',
  positionFixedClass: 'is-position-fixed',
  fixedSidebarOffset: 'auto',
  scrollSmooth: true,
  scrollSmoothOffset: -80,
  headingsOffset: -500
});
}
</script>
</body>
</html>
